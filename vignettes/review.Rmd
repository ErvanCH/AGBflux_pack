---
title: "Review"
author: "Mauro Lepore"
date: "2017-08-28"
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 6
vignette: >
  %\VignetteIndexEntry{Review}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE, message=FALSE, warning=FALSE}
# hadley's settings
set.seed(1014)
options(digits = 3)

knitr::opts_chunk$set(
  echo = TRUE,  # {mine}
  comment = "#>",
  collapse = TRUE,
  # cache = TRUE,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,  # 1 / phi
  fig.show = "hold"
)

options(dplyr.print_min = 6, dplyr.print_max = 6)
```



# Title and description

The title and description tell your users what your package does. You will need them on multiple places:

* on DESCRIPTION.

* on README.

* on the package documentation\* (http://r-pkgs.had.co.nz/man.html#man-packages). (After I install a new package, I typically run `?PACKAGENAME` to learn what the package does. Then I scroll down to the bottom, and click the link to the "Index", to see all functions skim their titles.)

* on GitHub, under the name of your package (title only).

For consistency and speed, you may write a title and description once and copy it everywhere. I sometimes us rstudio snippets, but this will also work:

```{r}
entitle_mypkg <- function() {
  message("My Package Title")
}
entitle_mypkg()

describe_mypkg <- function() {
  message("My package description.")
}
describe_mypkg()
```



# DESCRIPTON

About your DESCRIPTION file:

* `Type:` I'm not sure what this field does.
* `Version:` Consider using a development version until released. The book _R Packages_ recommends adding .9000 to the end of a development verison number to clearly indicate it is not a released version.
* Author`and `Maintainer`: Both fields can be documented with `person()` (see `?person`). `person()` also offers other potentially useful roles.



# Package Infrasctructure

These functions can help you build useful infrastructure for your package (see `?devtools::infrastructure`):
```
library(devtools)

# Edits DESCRIPTION
use_dev_version()
use_gpl3_license()

# Documentation
use_package_doc()
use_vignette()

# Tests and checks
use_testthat()
use_test(TESTNAME)
use_travis()
use_coverage()
```



# README

If you add a README file, that information will appear at the Home of the package website, and also on the front page of your package repository. `README` should cover the goal of the package, installation instructions, and an example.

* Add a README file with `devtools::use_readme_rmd()`. 

* Remember to knit that .Rmd file whenever you update it. That will generate a .md version. Don't edit the .md version; edit the .Rmd only.



# Website 

You can bulid and update a your package website simply by running `pkgdown::build_site()` (I already did this). The website  will live in the folder docs/. To host on GitHub go to: Settings > GitHubPages > Source > master branch /docs folder.



# NEWS

NEWS is where you can explain the main features of each version of your package. Add a NEWS file with `devtools::use_news_md()` (I already did this). Knit NEWS after updating it (Control + Shift + K).

You may need to manually fix the name of your package in NEWS. When I created NEWS with `devtools::use_news_md()`, the name of your package was automatically chopped from "_" onwards.



# Checks

Run `devtools::check()` (find "Check" in the Build tab) and address errors, warnings and notes.

```{r, echo=FALSE}
knitr::include_graphics("https://i.imgur.com/yYzv7W0.png")
```

## Notes

The DESCRIPTON file  has a problem:

```
checking DESCRIPTION meta-information ... NOTE
Malformed Title field: should not end in a period.
```

To solve it, remove the period at the end of the sentence you wrote on the Title field. Also consider this (http://r-pkgs.had.co.nz/description.html)

* shorten the sentence to 80 characters or less.
* use Title Type Capitalization

Also, the Licence field has a problem:

```
Non-standard license specification:
  What license is it under?
Standardizable: FALSE
```

This should guide you to solve it:

> The License field can be either a standard abbreviation for an open source license, like GPL-2 or BSD, or a pointer to a file containing more information, file LICENSE. The license is really only important if you're planning on releasing your package. If you don't, you can ignore this section. If you want to make it clear that your package is not open source, use License: file LICENSE and then create a file called LICENSE, containing for example:

```
Proprietary 

Do not distribute outside of Widgets Incorporated.
```

--http://r-pkgs.had.co.nz/description.html


## Warnings

This information helps you solve a number of issues. I'll mention a couple of important ones. You'll be able to work out the rest. (If the information is unclear, you may find more details here; http://r-pkgs.had.co.nz/check.html)

In the documentation of some function, some parameters that those functions use remain undocumented. One good way to not any important piece of documentation is to step on the function's name and press Ctrl + Shift + Alt + R. That will automatically write the roxygen skeleton of key documentation inluding all parameters. If you need to use the same  parameter in multiple functions, you may avoid duplicating its documentation with [\@template](https://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html).

Also, you need to rename sume functions. For example, if you rename  `density.ind()` as `density_ind()` you will avoid R thinking that `density.ind()` is an S3 method of the generic function `density()` (http://adv-r.had.co.nz/OO-essentials.html#s3). Again, that is why it is safer to avoid "." in function names, unless you intend to wirite an S3 object.






# Tests

You are already testing, but likely in a non-systematic way: you write a function, run it, and see its output  on the console to check check if it's right. You, the developer, will save you a lot of time if you test systematically, with an automatic unit testing system such as the __[testthat](https://cran.r-project.org/web/packages/testthat/testthat.pdf)__ package. To use __testthat__ you can simply run:


```
devtools::use_testthat()
```

I already did that, so you will see `tests/` in the root directory of your package. Then you add new tests with:

```
devtools::use_test("dummytest")
```

Notice that you now have the file ./tests/thestthat/test-dummytest.R.



Another type of test that you are already using are assertions. For example, in your code you have something  like this:

``` r
x <- c(1:3, NA)
if (any(is.na(x))) {stop("x contains NA")}
#> Error in eval(expr, envir, enclos): x contains NA

# Or
stopifnot(!any(is.na(x)))
#> Error: !any(is.na(x)) is not TRUE
```

Assertions are nicely implemented with the __[assertive](https://cran.r-project.org/web/packages/assertive/assertive.pdf)__ package. With __assertive__ you can do something like this:

``` r
assertive::assert_all_are_not_na(x)
#> Error in assert_engine(is_not_na, x, coerce_to_logical = FALSE, msg = msg, : object 'x' not found
# Warn instead or err
assertive::assert_all_are_not_na(x, severity = "warning")
#> Error in assert_engine(is_not_na, x, coerce_to_logical = FALSE, msg = msg, : object 'x' not found
```

Assertions target not the developer but the user; they err, warn of give messages to the user when something is wrong or suspicious. 

This are good resources to learn more about unit tests and assertions:

* http://r-pkgs.had.co.nz/tests.html
* [Testing R code, by Richard Cotton](https://www.crcpress.com/Testing-R-Code/Cotton/p/book/9781498763653).




# Functions

* __Grouping functions within files.__ Consider grouping functions in files by topic.

* __Tab versus space.__ Avoid using tab to insert spaces. Instead use space (see section _Style_).

* __Lines width.__ Keep the widh of each line no longer than 80 characters. This improves readability. To achive this:

    + Set a guide line at 80 characters page width: Tools > Global Options > Code > Display > Show Margin > Margin Column = 80.
  
    + For comments (both normal comments and roxygen comments), master these two keyboard shortcuts:
        - Shift + Control + C to comment a line/paragraph.
        - Shift + Control + / to brake a paragraph into lines no longer than 80 characters.

* Conform with a style guide (see section Style) by reformating the code manually or with (select then) Control + Shift + A, or  `formatR::tidy_code()` (this one, you likely have in your Addins popup menu). This will add spaces after commas, brake lines to fit within  80 characters width, add spaces around equal signs, etc. You may dislike that formatting style butitiseasiertoread.

* Check the style of your package with the __lintr__ package. Also see `goodpractice::gp()`.



## Author

If the author of the package is the author of a function, then that author needs not to be explicitely mentioned in each help file. In other words, use \@author in help files of functions written but people other than the authors of the package.



# Style

Use a style guide, e.g. 

* http://style.tidyverse.org/ (the one I use).

> Variable and function names should use only lowercase letters, numbers, and _.

> Use underscores (_) to separate words within a name. Base R uses dots in function names (contrib.url()) and class names (data.frame), but it's better to reserve dots exclusively for the S3 object system. In S3, methods are given the name function.class; if you also use . in function and class names you end up with confusing methods like as.data.frame.data.frame().

--http://style.tidyverse.org/syntax.html#object-names



```
i_use_snake_case
otherPeopleUseCamelCase
some.people.use.periods
And_aFew.People_RENOUNCEconvention
```

--http://r4ds.had.co.nz/workflow-basics.html#whats-in-a-name

Another style guide is this one: https://google.github.io/styleguide/Rguide.xml.



# Data

You usually need some data, even dummy data, for examples and tests. See `devtools::use_data()`. Or you may want to place data in its own package. An example of this is the package __babynames__. This allows you to reuse  the same  data in different  projects, and to track data versions in the same way you can track package versions. A specific version is easy to install with `devtools::install_github("username/packagename@version")`. 



# Other things to start thinking about

* Once you are using automated unit tests, you may want to measuere code cover. For example with the  __covr__ package (see `devtools::use_coverage()`).

* Once you are confident of the checks you do locally, you may want to use continuous integration. For example with TravisCI (see `devtools::use_travis()`).




